# 首页统计接口文档

## 接口概述

首页统计模块提供今日数据总览、课程详情等统计信息，支持数据缓存和手动刷新功能。

**基础路径**: `/api/dashboard`

---

## 1. 获取今日首页完整数据

### 接口信息
- **请求方式**: `GET`
- **接口路径**: `/api/dashboard/today`
- **功能描述**: 获取今日数据总览和课程详情
- **缓存时间**: 5分钟

### 请求参数
无

### 响应数据
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "overview": {
      // 数据总览对象，详见下方DashboardOverviewVO字段说明
    },
    "courseDetails": [
      // 课程详情数组，详见下方CourseDetailVO字段说明
    ]
  }
}
```

---

## 2. 获取今日数据总览

### 接口信息
- **请求方式**: `GET`
- **接口路径**: `/api/dashboard/overview`
- **功能描述**: 获取今日上课老师、学员、打卡次数等统计数据
- **缓存时间**: 5分钟

### 请求参数
无

### 响应数据
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // DashboardOverviewVO对象，详见下方字段说明
  }
}
```

---

## 3. 获取今日课程详情

### 接口信息
- **请求方式**: `GET`
- **接口路径**: `/api/dashboard/courses`
- **功能描述**: 获取今日按教练分组的课程信息和学员打卡记录
- **缓存时间**: 5分钟

### 请求参数
无

### 响应数据
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    // CourseDetailVO对象数组，详见下方字段说明
  ]
}
```

---

## 4. 手动刷新今日数据缓存

### 接口信息
- **请求方式**: `POST`
- **接口路径**: `/api/dashboard/refresh`
- **功能描述**: 手动清除并重新计算今日数据缓存

### 请求参数
无

### 响应数据
```json
{
  "code": 200,
  "message": "操作成功",
  "data": "数据刷新成功"
}
```

---

## 数据字段详细说明

### DashboardOverviewVO - 数据总览对象

#### 今日数据
| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `teacherCount` | Integer | 今日上课老师数量 | 3 |
| `classCount` | Integer | 今日上课班级数量 | 3 |
| `studentCount` | Integer | 今日上课学员数量 | 11 |
| `checkinCount` | Integer | 今日打卡次数 | 11 |
| `consumedHours` | BigDecimal | 今日消耗课时 | 11.00 |
| `leaveCount` | Integer | 今日请假人数 | 3 |
| `teacherRemuneration` | BigDecimal | 今日老师课酬总额 | 950.00 |
| `consumedFees` | BigDecimal | 今日消耗费用总额 | 2902.00 |

#### 总体数据
| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `totalRevenue` | BigDecimal | 总流水 | 128645.00 |
| `totalRevenueChangePercent` | BigDecimal | 总流水较上周变化百分比 | 5.2 |
| `totalProfit` | BigDecimal | 总利润 | 62290.00 |
| `totalProfitChangePercent` | BigDecimal | 总利润较上周变化百分比 | 4.1 |
| `totalStudents` | Integer | 总学员数 | 102 |
| `totalStudentsChangePercent` | BigDecimal | 总学员数较上周变化百分比 | 8.0 |
| `totalCoaches` | Integer | 教练总数量 | 8 |
| `partTimeCoaches` | Integer | 兼职教练数量 | 3 |
| `fullTimeCoaches` | Integer | 全职教练数量 | 5 |

#### 本周数据
| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `currentWeekClassHoursRatio` | String | 本周课时比例（已销/总课时） | "18/35" |
| `currentWeekSalesAmount` | BigDecimal | 本周销课金额 | 12800.00 |
| `currentWeekPayingStudents` | Integer | 本周缴费学员总数 | 7 |
| `currentWeekNewPayingStudents` | Integer | 本周新学员缴费数 | 3 |
| `currentWeekRenewalPayingStudents` | Integer | 本周续费学员缴费数 | 4 |
| `currentWeekPaymentAmount` | BigDecimal | 本周缴费总金额 | 28760.00 |
| `currentWeekNewStudentPaymentAmount` | BigDecimal | 本周新学员缴费金额 | 15200.00 |
| `currentWeekRenewalPaymentAmount` | BigDecimal | 本周续费学员缴费金额 | 13560.00 |
| `currentWeekAttendanceRate` | BigDecimal | 本周出勤率（百分比） | 94.2 |
| `currentWeekAttendanceRateChangePercent` | BigDecimal | 本周出勤率较上周变化百分比 | 1.7 |

### CourseDetailVO - 课程详情对象

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `courseName` | String | 课程名称 | "杨大冬课程" |
| `coachName` | String | 教练姓名 | "1对1-杨教练" |
| `hours` | BigDecimal | 课时数 | 8.00 |
| `remuneration` | BigDecimal | 课酬 | 300.00 |
| `salesAmount` | BigDecimal | 销课金额 | 1056.60 |
| `studentAttendances` | List<StudentAttendanceVO> | 学员打卡记录列表 | 见下方说明 |

### StudentAttendanceVO - 学员打卡记录对象

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| `studentName` | String | 学员姓名 | "张小明" |
| `timeSlot` | String | 时间段 | "15:30-16:30" |
| `status` | String | 状态 | "已完成" |

**状态说明**:
- `已完成`: 学员已打卡完成
- `请假`: 学员请假
- `未打卡`: 学员未打卡

---

## 使用示例

### 获取完整首页数据
```bash
curl -X GET "http://jufeng.devtesting.top/lesson/api/dashboard/today" \
  -H "Authorization: Bearer your_token"
```

### 获取数据总览
```bash
curl -X GET "http://jufeng.devtesting.top/lesson/api/dashboard/overview" \
  -H "Authorization: Bearer your_token"
```

### 获取课程详情
```bash
curl -X GET "http://jufeng.devtesting.top/lesson/api/dashboard/courses" \
  -H "Authorization: Bearer your_token"
```

### 刷新数据缓存
```bash
curl -X POST "http://jufeng.devtesting.top/lesson/api/dashboard/refresh" \
  -H "Authorization: Bearer your_token"
```

---

## 注意事项

1. **缓存机制**: 所有接口都使用Redis缓存，缓存时间为5分钟
2. **数据实时性**: 如需获取最新数据，可调用刷新接口
3. **权限要求**: 需要有效的JWT Token认证
4. **机构隔离**: 数据按机构ID进行隔离，只返回当前机构的数据
5. **错误处理**: 所有接口都有统一的错误处理机制，返回标准的Result格式

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 401 | 未授权，Token无效或过期 |
| 500 | 服务器内部错误 |

---

## 更新日志

- **2025-09-16**: 创建首页统计接口文档
- 包含4个主要接口：今日完整数据、数据总览、课程详情、缓存刷新
- 详细字段说明涵盖今日数据、总体数据、本周数据等维度
- 提供完整的请求示例和错误处理说明
