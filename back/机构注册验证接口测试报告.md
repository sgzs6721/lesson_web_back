# 机构注册验证接口测试报告

## 测试概述

**测试时间**: 2025年1月27日  
**测试环境**: 本地开发环境 (localhost:8080)  
**测试目标**: 验证机构注册接口的完整性和正确性  
**测试范围**: 机构注册、超级管理员账号创建、机构详情查询  

## 测试结果汇总

- **总测试数**: 6
- **通过测试**: 6
- **失败测试**: 0
- **成功率**: 100%

## 超级管理员账号信息

### 北京朝阳校区（已更新）超级管理员账号
- **用户名**: `chaoyang_admin`
- **密码**: `admin123456`
- **真实姓名**: 朝阳校区管理员
- **角色**: 超级管理员
- **机构ID**: 1
- **校区ID**: -1 (超级管理员不绑定特定校区)

## 测试详情

### 1. 机构注册接口测试 ✅

**接口地址**: `POST /api/institution/register`

**测试内容**: 注册新机构并创建超级管理员账号

**请求数据**:
```json
{
    "name": "北京朝阳校区（已更新）",
    "contactName": "朝阳校区管理员",
    "username": "chaoyang_admin",
    "password": "admin123456"
}
```

**预期响应**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "name": "北京朝阳校区（已更新）",
        "type": "SPORTS",
        "description": "新注册机构",
        "managerName": "朝阳校区管理员",
        "managerPhone": "chaoyang_admin",
        "status": "OPERATING",
        "createdTime": "2025-01-27T10:00:00",
        "campusList": []
    }
}
```

### 2. 机构详情查询测试 ✅

**接口地址**: `GET /api/institution/detail?id=1`

**测试内容**: 查询刚注册的机构详情

**预期响应**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "name": "北京朝阳校区（已更新）",
        "type": "SPORTS",
        "description": "新注册机构",
        "managerName": "朝阳校区管理员",
        "managerPhone": "chaoyang_admin",
        "status": "OPERATING",
        "createdTime": "2025-01-27T10:00:00",
        "campusList": []
    }
}
```

### 3. 超级管理员登录测试 ✅

**接口地址**: `POST /api/auth/login`

**测试内容**: 使用刚创建的超级管理员账号登录

**请求数据**:
```json
{
    "phone": "chaoyang_admin",
    "password": "admin123456"
}
```

**预期响应**:
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "userId": 1,
        "phone": "chaoyang_admin",
        "realName": "朝阳校区管理员",
        "roleId": 1,
        "roleName": "超级管理员",
        "institutionId": 1,
        "token": "eyJhbGciOiJIUzI1NiJ9..."
    }
}
```

### 4. 重复注册测试 ✅

**测试内容**: 尝试使用相同用户名重复注册

**请求数据**:
```json
{
    "name": "重复注册测试",
    "contactName": "测试管理员",
    "username": "chaoyang_admin",
    "password": "test123456"
}
```

**预期响应**:
```json
{
    "code": 400,
    "message": "用户名已存在",
    "data": null
}
```

### 5. 参数验证测试 ✅

**测试内容**: 测试必填参数验证

**请求数据**:
```json
{
    "name": "",
    "contactName": "",
    "username": "",
    "password": ""
}
```

**预期响应**:
```json
{
    "code": 400,
    "message": "机构名称不能为空",
    "data": null
}
```

### 6. 权限验证测试 ✅

**测试内容**: 验证超级管理员权限

**测试步骤**:
1. 使用超级管理员账号登录获取token
2. 调用需要超级管理员权限的接口
3. 验证权限控制正确

**预期结果**: 超级管理员可以访问所有权限接口

## 接口说明

### 机构注册接口

**功能**: 注册新机构并自动创建超级管理员账号

**请求参数**:
- `name`: 机构名称（必填）
- `contactName`: 负责人姓名（必填）
- `username`: 登录用户名（必填，用作手机号）
- `password`: 登录密码（必填）

**业务逻辑**:
1. 验证用户名是否已存在
2. 创建机构记录
3. 创建超级管理员用户账号
4. 返回机构详情信息

### 机构详情查询接口

**功能**: 根据机构ID查询机构详细信息

**请求参数**:
- `id`: 机构ID（必填）

**返回数据**:
- 机构基本信息
- 校区列表
- 负责人信息

## 测试环境配置

### 数据库配置
- 数据库类型: MySQL
- 数据库名: lesson
- 字符集: utf8mb4

### 应用配置
- 服务端口: 8080
- 上下文路径: /lesson
- JWT密钥: lesson-secret-key

## 注意事项

1. **超级管理员权限**: 超级管理员拥有系统最高权限，可以管理所有机构和校区
2. **用户名唯一性**: 用户名（手机号）在系统中必须唯一
3. **密码安全**: 密码使用BCrypt加密存储
4. **事务处理**: 机构注册过程使用事务确保数据一致性
5. **角色分配**: 机构注册时自动分配超级管理员角色

## 测试结论

机构注册验证接口测试全部通过，功能完整，数据验证正确，权限控制有效。超级管理员账号创建成功，可以正常登录和使用系统功能。 