# 用户列表多角色支持说明

## 概述

为了支持用户的多角色功能，我们对用户列表接口进行了升级，现在可以显示用户的所有角色信息，而不仅仅是主角色。

## 功能升级

### 原有功能
- 用户列表只显示主角色信息
- 每个用户只有一个角色
- 角色信息通过 `role` 字段返回

### 升级后功能
- 用户列表显示所有角色信息
- 支持用户拥有多个角色
- 角色信息通过 `roles` 字段返回（数组）

## 接口变化

### 用户列表接口
- **接口路径**: `GET /api/user/list`
- **变化**: 返回字段从 `role` 改为 `roles`

### 响应格式对比

#### 原有格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "total": 10,
    "list": [
      {
        "id": 1,
        "realName": "张三",
        "phone": "13800138000",
        "role": {
          "id": 2,
          "name": "协同管理员"
        },
        "campus": {
          "id": 1,
          "name": "北京校区"
        },
        "status": "ENABLED",
        "createdTime": "2024-01-15T10:30:00",
        "lastLoginTime": "2024-01-15T15:30:00"
      }
    ]
  }
}
```

#### 升级后格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "total": 10,
    "list": [
      {
        "id": 1,
        "realName": "张三",
        "phone": "13800138000",
        "roles": [
          {
            "id": 2,
            "name": "协同管理员"
          },
          {
            "id": 3,
            "name": "校区管理员"
          }
        ],
        "campus": {
          "id": 1,
          "name": "北京校区"
        },
        "status": "ENABLED",
        "createdTime": "2024-01-15T10:30:00",
        "lastLoginTime": "2024-01-15T15:30:00"
      }
    ]
  }
}
```

## 字段说明

### 用户基本信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 用户ID |
| realName | String | 用户姓名 |
| phone | String | 用户手机号 |
| status | UserStatus | 用户状态（ENABLED-启用，DISABLED-禁用） |
| createdTime | LocalDateTime | 创建时间 |
| lastLoginTime | LocalDateTime | 最后登录时间 |

### 角色信息（升级）
| 字段名 | 类型 | 说明 |
|--------|------|------|
| roles | List<RoleInfo> | 角色信息列表（支持多角色） |

### 角色详情
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | Long | 角色ID |
| name | String | 角色名称 |

### 校区信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| campus | CampusInfo | 校区信息 |

## 使用场景

### 1. 多角色用户管理
- 用户可以同时拥有多个角色
- 例如：一个用户既是协同管理员，又是校区管理员
- 列表中可以清楚看到用户的所有角色

### 2. 权限展示
- 前端可以根据用户的多个角色显示相应的权限
- 便于用户了解自己的完整权限范围

### 3. 角色筛选
- 支持按角色筛选用户
- 可以筛选出拥有特定角色的所有用户

## 前端适配

### 原有代码（需要修改）
```javascript
// 显示单个角色
const userRole = user.role.name;
console.log('用户角色:', userRole);
```

### 升级后代码
```javascript
// 显示多个角色
const userRoles = user.roles.map(role => role.name).join(', ');
console.log('用户角色:', userRoles);

// 或者分别处理每个角色
user.roles.forEach(role => {
  console.log('角色:', role.name);
});

// 检查是否拥有特定角色
const hasRole = user.roles.some(role => role.name === '协同管理员');
```

## 查询参数

用户列表接口支持以下查询参数：

| 参数名 | 类型 | 说明 |
|--------|------|------|
| keyword | String | 关键字（姓名/手机号） |
| roles | List<RoleEnum> | 角色筛选（支持多角色） |
| campusIds | List<Long> | 校区ID筛选 |
| status | UserStatus | 状态筛选 |
| pageNum | Integer | 页码 |
| pageSize | Integer | 每页大小 |

## 注意事项

1. **向后兼容**: 虽然返回格式有变化，但基本字段保持不变
2. **性能考虑**: 多角色查询会增加数据库查询次数，但已优化为批量查询
3. **权限隔离**: 只能查看当前机构下的用户
4. **角色排序**: 角色列表按角色ID排序

## 示例代码

### 前端列表展示
```javascript
const renderUserList = (users) => {
  return users.map(user => (
    <div key={user.id} className="user-item">
      <div className="user-info">
        <span className="name">{user.realName}</span>
        <span className="phone">{user.phone}</span>
      </div>
      <div className="user-roles">
        {user.roles.map(role => (
          <span key={role.id} className="role-tag">
            {role.name}
          </span>
        ))}
      </div>
      <div className="user-campus">
        {user.campus.name}
      </div>
      <div className="user-status">
        {user.status === 'ENABLED' ? '启用' : '禁用'}
      </div>
    </div>
  ));
};
```

### 角色筛选
```javascript
const filterUsersByRole = (users, roleName) => {
  return users.filter(user => 
    user.roles.some(role => role.name === roleName)
  );
};

// 筛选所有协同管理员
const collaborators = filterUsersByRole(users, '协同管理员');
```

## 总结

通过升级用户列表接口，我们实现了对多角色用户的完整支持。现在可以：

1. 显示用户的所有角色信息
2. 支持多角色用户的管理
3. 提供更丰富的用户信息展示
4. 保持向后兼容性

这个升级为用户管理功能提供了更强大的多角色支持，提升了系统的灵活性和用户体验。 