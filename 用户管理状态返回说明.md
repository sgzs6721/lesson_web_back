# 用户管理状态返回说明

## 概述

为了提供更好的用户体验和更详细的操作反馈，我们为用户管理功能增加了详细的状态返回机制。

## 功能对比

### 原有接口
- **创建用户**: `POST /api/user/create`
- **更新用户**: `POST /api/user/update`
- **返回内容**: 仅返回用户ID或操作结果
- **示例响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": 12345
}
```

### 新增接口（推荐使用）
- **创建用户**: `POST /api/user/create-with-status`
- **更新用户**: `POST /api/user/update-with-status`
- **返回内容**: 返回详细的用户状态信息
- **示例响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 12345,
    "realName": "张三",
    "phone": "13800138000",
    "status": "ENABLED",
    "institutionId": 1,
    "institutionName": "某某教育机构",
    "campusId": 1,
    "campusName": "北京校区",
    "roles": [
      {
        "roleId": 2,
        "roleName": "协同管理员",
        "roleDesc": "协同管理员，协助管理系统",
        "permissions": ["user:list", "user:create", "user:update"]
      },
      {
        "roleId": 3,
        "roleName": "校区管理员",
        "roleDesc": "校区管理员，管理单个校区",
        "permissions": ["campus:list", "student:list"]
      }
    ],
    "operationStatus": "SUCCESS",
    "operationMessage": "用户创建成功",
    "operationTime": "2024-01-15T10:30:00"
  }
}
```

## 详细字段说明

### 用户基本信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| userId | Long | 用户ID |
| realName | String | 用户姓名 |
| phone | String | 用户手机号 |
| status | String | 用户状态（ENABLED-启用，DISABLED-禁用） |
| institutionId | Long | 机构ID |
| institutionName | String | 机构名称 |
| campusId | Long | 校区ID |
| campusName | String | 校区名称 |

### 角色信息
| 字段名 | 类型 | 说明 |
|--------|------|------|
| roleId | Long | 角色ID |
| roleName | String | 角色名称 |
| roleDesc | String | 角色描述 |
| permissions | List<String> | 权限列表 |

### 操作状态
| 字段名 | 类型 | 说明 |
|--------|------|------|
| operationStatus | String | 操作状态（SUCCESS-成功，FAILED-失败） |
| operationMessage | String | 操作消息 |
| operationTime | LocalDateTime | 操作时间 |

## 使用场景

### 1. 用户创建
- **接口**: `POST /api/user/create-with-status`
- **场景**: 创建新用户时，需要立即获取用户的完整信息
- **优势**: 
  - 无需额外调用查询接口获取用户详情
  - 可以立即显示用户的角色和权限信息
  - 便于前端进行后续操作

### 2. 用户更新
- **接口**: `POST /api/user/update-with-status`
- **场景**: 更新用户信息后，需要确认更新结果
- **优势**:
  - 可以验证更新是否成功
  - 获取更新后的完整用户信息
  - 便于前端刷新用户列表或详情页面

## 错误处理

当操作失败时，接口会返回错误信息：

```json
{
  "code": 500,
  "message": "用户创建失败：手机号已存在",
  "data": {
    "userId": null,
    "operationStatus": "FAILED",
    "operationMessage": "用户创建失败：手机号已存在",
    "operationTime": "2024-01-15T10:30:00"
  }
}
```

## 权限要求

- **创建用户**: 需要 `user:create` 权限
- **更新用户**: 需要 `user:update` 权限

## 注意事项

1. **向后兼容**: 原有的接口仍然可用，不会影响现有功能
2. **性能考虑**: 新接口会查询更多信息，响应时间可能稍长
3. **权限隔离**: 只能操作当前机构下的用户
4. **角色验证**: 不允许创建或修改为超级管理员角色

## 示例代码

### 前端调用示例

```javascript
// 创建用户
const createUser = async (userData) => {
  try {
    const response = await fetch('/api/user/create-with-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(userData)
    });
    
    const result = await response.json();
    if (result.code === 200) {
      const userInfo = result.data;
      console.log('用户创建成功:', userInfo);
      // 可以直接使用返回的用户信息
      showUserDetails(userInfo);
    } else {
      console.error('用户创建失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
};

// 更新用户
const updateUser = async (userData) => {
  try {
    const response = await fetch('/api/user/update-with-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(userData)
    });
    
    const result = await response.json();
    if (result.code === 200) {
      const userInfo = result.data;
      console.log('用户更新成功:', userInfo);
      // 可以直接使用返回的用户信息
      refreshUserList(userInfo);
    } else {
      console.error('用户更新失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
};
```

## 总结

通过引入状态返回机制，用户管理功能提供了更丰富的操作反馈，提升了用户体验，简化了前端开发工作。建议在新功能开发中优先使用带状态返回的接口。 