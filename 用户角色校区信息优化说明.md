# 用户角色校区信息优化说明

## 概述

为了提供更完整的用户角色信息，在用户列表接口的 `roles` 字段中，为校区管理员角色添加校区ID和校区名称信息，而其他角色（超级管理员、协同管理员）的校区相关字段保持为 `null`。

## 修改内容

### 1. 数据结构优化

#### 修改前
```json
{
  "roles": [
    {
      "id": 1,
      "name": "超级管理员",
      "roleEnum": "SUPER_ADMIN"
    },
    {
      "id": 3,
      "name": "校区管理员",
      "roleEnum": "CAMPUS_ADMIN",
      "campusId": 1
    }
  ]
}
```

#### 修改后
```json
{
  "roles": [
    {
      "id": 1,
      "name": "超级管理员",
      "roleEnum": "SUPER_ADMIN"
      // campusId 和 campusName 不显示（为null）
    },
    {
      "id": 3,
      "name": "校区管理员",
      "roleEnum": "CAMPUS_ADMIN",
      "campusId": 1,
      "campusName": "北京朝阳校区"
    }
  ]
}
```

### 2. 字段说明

| 字段名 | 类型 | 说明 | 适用角色 |
|--------|------|------|----------|
| id | Long | 角色ID | 所有角色 |
| name | String | 角色名称 | 所有角色 |
| roleEnum | RoleEnum | 角色枚举 | 所有角色 |
| campusId | Long | 校区ID | 仅校区管理员 |
| campusName | String | 校区名称 | 仅校区管理员 |

### 3. 角色分类

#### 超级管理员 (SUPER_ADMIN)
- `campusId`: `null`
- `campusName`: `null`
- 说明: 超级管理员不绑定特定校区

#### 协同管理员 (COLLABORATOR)
- `campusId`: `null`
- `campusName`: `null`
- 说明: 协同管理员不绑定特定校区

#### 校区管理员 (CAMPUS_ADMIN)
- `campusId`: 校区ID（如：1）
- `campusName`: 校区名称（如："北京朝阳校区"）
- 说明: 校区管理员绑定特定校区

## 实现细节

### 1. 数据结构修改

**文件**: `src/main/java/com/lesson/vo/user/UserListVO.java`

```java
@Data
@Schema(description = "角色信息")
public static class RoleInfo {
    @Schema(description = "角色ID")
    private Long id;

    @Schema(description = "角色名称")
    private String name;

    @Schema(description = "角色枚举")
    private RoleEnum roleEnum;

    @JsonInclude(JsonInclude.Include.NON_NULL)
    @Schema(description = "校区ID（校区管理员角色时使用）")
    private Long campusId;

    @JsonInclude(JsonInclude.Include.NON_NULL)
    @Schema(description = "校区名称（校区管理员角色时使用）")
    private String campusName;
}
```

### 2. 业务逻辑修改

**文件**: `src/main/java/com/lesson/service/impl/UserServiceImpl.java`

```java
// 如果是校区管理员角色，需要包含校区ID和校区名称
if ("校区管理员".equals(role.getRoleName())) {
    // 获取用户的校区信息
    UserListVO.CampusInfo campusInfo = userCampusMap.get(userId);
    if (campusInfo != null && campusInfo.getId() != null) {
        roleInfo.setCampusId(campusInfo.getId());
        roleInfo.setCampusName(campusInfo.getName());
    }
}
// 其他角色（超级管理员、协同管理员）的campusId和campusName保持为null
```

## 使用场景

### 1. 前端展示
```javascript
// 显示用户角色信息
user.roles.forEach(role => {
  if (role.roleEnum === 'CAMPUS_ADMIN') {
    console.log(`${role.name}: ${role.campusName}`);
  } else {
    console.log(role.name);
  }
});
```

### 2. 权限判断
```javascript
// 判断用户是否是特定校区的管理员
const isCampusAdmin = user.roles.some(role => 
  role.roleEnum === 'CAMPUS_ADMIN' && role.campusId === targetCampusId
);
```

### 3. 校区信息展示
```javascript
// 获取用户的校区信息
const campusInfo = user.roles.find(role => 
  role.roleEnum === 'CAMPUS_ADMIN'
);
if (campusInfo) {
  console.log(`校区: ${campusInfo.campusName} (ID: ${campusInfo.campusId})`);
}
```

## 优势

1. **信息完整性**: 校区管理员角色包含完整的校区信息
2. **数据清晰**: 非校区管理员角色的校区字段为null，避免混淆
3. **前端友好**: 前端可以直接使用校区信息，无需额外查询
4. **性能优化**: 减少前端额外的API调用

## 注意事项

1. **JSON序列化**: 使用 `@JsonInclude(JsonInclude.Include.NON_NULL)` 确保null值不显示在JSON中
2. **数据一致性**: 确保校区ID和校区名称的一致性
3. **权限控制**: 校区信息只对校区管理员角色显示
4. **向后兼容**: 不影响现有的API调用

## 测试建议

1. **超级管理员测试**: 验证校区字段为null
2. **协同管理员测试**: 验证校区字段为null
3. **校区管理员测试**: 验证校区字段有正确的值
4. **多角色用户测试**: 验证不同角色的校区信息显示正确 